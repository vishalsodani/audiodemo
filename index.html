<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time PCM Data Sender</title>
</head>
<body>
    <script>
        // Establish a WebSocket connection to the server
        const socket = new WebSocket('ws://localhost:3000');

        // Request microphone access
        navigator.mediaDevices.getUserMedia({ audio: true })
            .then((mediaStream) => {
                // Create an audio context and a media stream source
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const sourceNode = audioContext.createMediaStreamSource(mediaStream);

                // Set up a script processor to handle PCM data
                const scriptNode = audioContext.createScriptProcessor(4096, 1, 1);

                // Connect the audio nodes
                sourceNode.connect(scriptNode);
                scriptNode.connect(audioContext.destination);

                // Handle PCM data
                scriptNode.onaudioprocess = (event) => {
                    const pcmData = event.inputBuffer.getChannelData(0);
                    
                    // Send PCM data to the server through the WebSocket connection
                    socket.send(new Int16Array(pcmData.buffer));
                };

                // Print a message when the WebSocket connection is opened
                socket.addEventListener('open', () => {
                    console.log('WebSocket connection opened');
                });

                // Print a message when the WebSocket connection is closed
                socket.addEventListener('close', () => {
                    console.log('WebSocket connection closed');
                });

                // Print an error message if there is a WebSocket error
                socket.addEventListener('error', (error) => {
                    console.error('WebSocket error:', error);
                });
            })
            .catch((error) => {
                console.error('Error accessing microphone:', error);
            });
    </script>
</body>
</html>
